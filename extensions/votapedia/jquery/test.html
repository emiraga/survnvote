<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>make question</title>
<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
<style type="text/css">
.rightButton{
	float: right;
	top: -15px;
	position: relative;
}
.rightButton2{
	float: right;
}
.questionBox{
	width: 600px;
	padding-bottom: 10px;
}
.choicesBox{
	width: 75%;
	padding-left: 10px;
}
.choiceItem
{
}
fieldset
{
	border: 1px solid #781351;
	background-color: #f0f0f0;
}
legend
{
	color: #000;
	background: #fff49c;
	border: 1px solid #781351;
	padding: 2px 6px;
	font-weight: bold;
}
</style>
</head>
<script type="text/javascript">
	function htmlspecialchars(str) {
		if (typeof(str) == "string") {
			str = str.replace(/&/g, "&amp;"); /* must do &amp; first */
			str = str.replace(/"/g, "&quot;");
			str = str.replace(/'/g, "&#039;");
			str = str.replace(/</g, "&lt;");
			str = str.replace(/>/g, "&gt;");
		}
		return str;
	}
	function rhtmlspecialchars(str) {
		if (typeof(str) == "string") {
			str = str.replace(/&gt;/ig, ">");
			str = str.replace(/&lt;/ig, "<");
			str = str.replace(/&#039;/g, "'");
			str = str.replace(/&quot;/ig, '"');
			str = str.replace(/&amp;/ig, '&'); /* must do &amp; last */
		}
		return str;
	}
	var numQuestions = 0; //number of questions added (including deleted ones)
	var numChoices = new Array();
	function addChoice(buttonElement, num)
	{
		numChoices[num]++;
		var id = 'q'+num+"c"+numChoices[num];
		var choice =  $(buttonElement).parent().find("#choice");
		if(choice.val().length < 1)
			return false;
		$('#q'+num+'choices').append(
			'<div class="choiceItem" style="display:none" id="'+id+'div">'
			+'<input type="radio" name="q'+num+'correct" id="'+id+'" value="'+escape(choice.val())+'">'
			+'<label for="'+id+'">'+htmlspecialchars(choice.val())+'</label>'
			+'<input type=hidden name="q'+num+'choices[]" value="'+escape(choice.val())+'" />'
			+'&nbsp;&nbsp;&nbsp;'
			+'<div class="rightButton2">'
			+'<input type="image" title="Move up choice" src="icons/arrow_up.png" onClick="return moveChoiceUp(this);" />'
			+'<img src="icons/spacer.gif" width="10px" />'
			+'<input type="image" title="Move down choice" src="icons/arrow_down.png" onClick="return moveChoiceDown(this);" />'
			+'<img src="icons/spacer.gif" width="10px" />'
			+'<input type="image" title="Delete choice" src="icons/comment_delete.png" onClick="return deleteChoice(this);" value="Delete" />'
			+'</div>'
			+'</div>'
		);
		choice.val('');
		$('#'+id+'div').show('fast');
		return false;
	}
	function generateChoices(num)
	{
		return ''
		+ '<div id="q'+num+'choices" class="choicesBox"></div>'
		+ '<div><input type=text id="choice" size="50" onkeypress="if((event.keyCode||event.which)==13) return addChoice(this, '+num+');" />'
		+ '<input type=button onClick="return addChoice(this, '+num+');" value="Add choice"></div>';
	}
	function generateQuestion(question, num)
	{
		if(question.length < 3)
			return '';
		return '<div class="questionBox" id="question'+num+'" style="display:none">'
		+ '<fieldset>'
		+ '<legend>Question: '+htmlspecialchars(question)+'</legend>'
		+ '<input class="rightButton" type="image" title="Delete question" src="icons/file_delete.png" onClick="return deleteQuestion(this);" value="Delete">'
		+ '<img class="rightButton" src="icons/spacer.gif" width="10px" />'
		+ '<input class="rightButton" type="image" title="Move down question" src="icons/arrow_down.png"  onClick="return moveQuestionDown(this);" value="Down">'
		+ '<img class="rightButton" src="icons/spacer.gif" width="10px" />'
		+ '<input class="rightButton" type="image" title="Move up question" src="icons/arrow_up.png" onClick="return moveQuestionUp(this);" value="Up">'
		//+ 'Question: <b>' + question + '</b><br/ ><br/ >'
		+ 'Choices:'
		+ '<input id="orderNum" type="hidden" name="orderNum[]" value="'+num+'">'
		+ '<input type="hidden" name="q'+num+'name" value="'+escape(question)+'">'
		+ generateChoices(num)
		+ '</fieldset></div>';
	}
	function deleteQuestion(buttonElement)
	{
		var par = $(buttonElement).parents(".questionBox");
		par.hide('slow', function() { $(this).remove() } );
		// par.find("#orderNum").remove();
		return false;
	}
	function moveQuestionUp(buttonEl)
	{
		var question = $(buttonEl).parents(".questionBox");
		question.slideUp('slow', function() { $(this).after( $(this).prev() ); $(this).slideDown('slow'); }  ) 
		return false;
	}
	function moveQuestionDown(buttonEl)
	{
		var question = $(buttonEl).parents(".questionBox")
		question.slideUp('slow', function() { $(this).before( $(this).next() ); $(this).slideDown('slow'); }  ) 
		return false;
	}

	function moveChoiceUp(buttonEl)
	{
		var choice = $(buttonEl).parents(".choiceItem");
		choice.slideUp('slow', function() { $(this).after( $(this).prev() ); $(this).slideDown('slow'); }  )
		return false;
	}
	function moveChoiceDown(buttonEl)
	{
		var choice = $(buttonEl).parents(".choiceItem");
		choice.slideUp('slow', function() { $(this).before( $(this).next() ); $(this).slideDown('slow'); }  ) 
		return false;
	}
	function deleteChoice(buttonElement)
	{
		var par = $(buttonElement).parents(".choiceItem");
		par.hide('slow', function() { $(this).remove() } );
		return false;
	}
	$(document).ready(function(){
		$("a#thanks").click(function(event){
			alert("Thanks for visiting!");
			event.preventDefault();
		});
	});
	function addQuestion()
	{
		numQuestions++;
		numChoices[numQuestions] = 0;

		var newQuestion = $("#newQuestion"); 
		$("#questions").append( generateQuestion( newQuestion.val(), numQuestions ) );
		newQuestion.val("");
		$("#question"+numQuestions).show('slow', function() {
			$("#question"+numQuestions).find("input#choice").focus();
		});
		return false;
	};
</script>
<body>
<form id="NewCurveyForm" action="dump.php" method="post">
<a href="#" id="thanks">click</a> <a href="">refresh</a> <br />

<div id="questions"></div>
<div>
New question:
<input type="text" name="newQuestion" id="newQuestion" size="50" onkeypress="if((event.keyCode||event.which)==13) return addQuestion();"  />
<input type="button" id="btnAddQuestion" value="Add question" onClick="return addQuestion();" />
</div>
<input type="submit" name="submit" value="Submit" />
</form>
</body>
</html>
